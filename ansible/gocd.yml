---
-
        name: Configure gocd-server
        hosts: gocd-server
        gather_facts: false
        tasks:
                - name: Check for python
                  raw: test -e /usr/bin/python
                  changed_when: false
                  failed_when: false
                  register: check_python

                - name: Install Python
                  raw: apt-get install python -y
                  when: check_python != 0


                - name: Add gocd repo key
                  apt-key:
                          url : https://download.gocd.org/GOCD-GPG-KEY.asc 
                          state: present

                - name: Update apt cache
                  apt:
                          update cache: yes

                - name: Install gocd-server
                  apt:
                          name: go-server
                          state: present

                - name: Install ansible
                  apt:
                          name: ansible
                          state: present
                          
                - name: Install git
                  apt:
                          name: git
                          state: present

                - name: Create terraform directory
                  file:
                        path: /opt/terraform 
                        state: directory                          
                          
                - name: Copy terraform executable
                  copy:
                    src: /opt/terraform/terraform
                    dest: /opt/terraform/terraform
                    owner: root
                    group: root
                    mode: '0755'
                
                - name: Copy terraform provider
                  copy:
                    src: /infra-as-code-challenge/terraform/provider.tf
                    dest: /infra-as-code-challenge/terraform/
                    owner: root
                    group: root
                    mode: '0644'

                - name: Copy terraform vars
                  copy:
                    src: /infra-as-code-challenge/terraform/terraform.tfvars
                    dest: /infra-as-code-challenge/terraform/
                    owner: root
                    group: root
                    mode: '0644'
